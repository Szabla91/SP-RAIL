<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Kalkulator Składowania LCL Kolej</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background-color: #fff; color: #222; margin: 0; padding: 0; }
    .btn-back {
      position: fixed;
      top: 10px;
      left: 10px;
      padding: 8px 16px;
      background-color: #be1e2d;
      color: white;
      font-weight: 600;
      border-radius: 6px;
      text-decoration: none;
      transition: background-color 0.3s ease;
      z-index: 1000;
      border: none;
    }
    .btn-back:hover {
      background-color: #a31520;
    }

    .page-content { padding: 40px; max-width: 1000px; margin: 0 auto; }
    h1 { color: #be1e2d; border-bottom: 2px solid #be1e2d; padding-bottom: 10px; margin-bottom: 30px; font-size: 2.3rem; text-align: center; font-weight: 700; }
    .section { background-color: #fafbfc; margin-bottom: 30px; border: 1.5px solid #e5e5e5; padding: 28px 24px; border-radius: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); max-width: 600px; margin-left: auto; margin-right: auto; }
    label { display: block; margin-top: 16px; font-weight: 500; color: #222; }
    select, input[type="date"], input[type="number"] { padding: 7px 12px; border: 1.5px solid #ccc; border-radius: 7px; width: 100%; max-width: 340px; margin-top: 5px; font-size: 1rem; box-sizing: border-box; font-family: inherit; }
    button { margin-top: 25px; padding: 12px 28px; background-color: #be1e2d; color: white; border: none; border-radius: 7px; cursor: pointer; font-weight: 700; font-size: 1.04rem; transition: background-color 0.22s; letter-spacing: 0.03em; }
    button:hover { background-color: #a31520; }
    #result_storage { margin-top: 26px; border-top: 1px solid #ddd; padding-top: 18px; color: #222; font-size: 1.06rem; }
    .hidden { display: none; }
    @media (max-width: 700px) { .page-content { padding: 15px; } .section { padding: 16px 5px; } }
  </style>
</head>
<body>
  <a href="https://bbats.sharepoint.com/:u:/r/sites/MLK/SitePages/RAIL.aspx?csf=1&web=1&e=zXznlj" class="btn-back">← Powrót do ekranu głównego</a>
<div class="page-content">
  <h1>Kalkulator Składowania LCL - Kolej</h1>
  <div class="section">
    <!-- Ilość W/M -->
    <label style="margin-top:20px;">
      Ilość CBM:
      <input type="number" id="wm" min="0" step="0.01" placeholder="np. 1.00" />
    </label>

    <label style="margin-top:20px;">Data rozładunku towaru na magazynie:
      <input type="date" id="unload_date" />
    </label>

    <label>Data odbioru towaru z magazynu:
      <input type="date" id="pickup_date" />
    </label>

    <button type="button" onclick="calculateRailStorage()">Oblicz koszty składowania</button>

    <div id="result_storage"></div>
  </div>
</div>

<script>
// Cennik dla wszystkich agentów z 3 USD per CBM oraz 5 dni wolnych
const pricing = { freeDays: 5, dailyRate: 3, minCost: 25, currency: "USD" };

function calculateRailStorage() {
  const unloadDate = new Date(document.getElementById('unload_date').value);
  const pickupDate = new Date(document.getElementById('pickup_date').value);
  const wm = parseFloat(document.getElementById('wm').value);
  const resultBox = document.getElementById('result_storage');
  resultBox.innerHTML = '';

  let errorMessage = '';
  if (isNaN(wm) || wm <= 0) errorMessage += 'Podaj ilość W/M większą od zera. ';
  if (unloadDate == "Invalid Date" || pickupDate == "Invalid Date") errorMessage += 'Wprowadź poprawne daty rozładunku i odbioru. ';
  if (unloadDate && pickupDate && pickupDate < unloadDate) errorMessage += 'Data odbioru nie może być wcześniejsza niż data rozładunku. ';

  if (errorMessage) {
    resultBox.innerHTML = `<p style="color: red;">${errorMessage}</p>`;
    return;
  }

  const daysInStorage = Math.round((pickupDate - unloadDate) / (24 * 60 * 60 * 1000)) + 1;
  let totalCost = 0;
  let exceededDays = Math.max(0, daysInStorage - pricing.freeDays);

  // Obliczanie kosztów
  totalCost = exceededDays * pricing.dailyRate * wm;
  if (totalCost < pricing.minCost && exceededDays > 0) totalCost = pricing.minCost;

  // Generowanie zakresu dni wolnych
  const freeStartDate = new Date(unloadDate);
  const freeEndDate = new Date(unloadDate);
  freeEndDate.setDate(freeEndDate.getDate() + pricing.freeDays - 1); // Dodaj dni wolne do daty rozładunku
  const freeDaysRange = `${freeStartDate.toLocaleDateString('pl-PL')} - ${freeEndDate.toLocaleDateString('pl-PL')}`;

  // Generowanie zakresu dni przekroczonych
  const exceededStartDate = new Date(freeEndDate);
  exceededStartDate.setDate(exceededStartDate.getDate() + 1); // Pierwszy przekroczony dzień to dzień po ostatnim dniu wolnym
  const exceededEndDate = new Date(pickupDate);
  let exceededDaysRange = '';
  if (exceededDays > 0) {
    exceededDaysRange = `${exceededStartDate.toLocaleDateString('pl-PL')} - ${exceededEndDate.toLocaleDateString('pl-PL')}`;
  }

  resultBox.innerHTML = `
    <p><strong>Okres składowania:</strong> ${unloadDate.toLocaleDateString('pl-PL')} – ${pickupDate.toLocaleDateString('pl-PL')}</p>
    <p><strong>Dni wolne:</strong> ${pricing.freeDays} (${freeDaysRange})</p>
    <p><strong>Przekroczone dni:</strong> ${exceededDays} ${exceededDays > 0 ? `(${exceededDaysRange})` : ''}</p>
    <p><strong>Stawka za dzień:</strong> ${pricing.dailyRate} ${pricing.currency} / CBM</p>
    <p><strong>Minimalna stawka:</strong> ${pricing.minCost} ${pricing.currency}</p>
    <p><strong><b>Łączny koszt:</b> <span style="color:#be1e2d;">${totalCost.toFixed(2)} ${pricing.currency}</span></strong></p>
  `;
}

// Funkcja ustawiająca dzisiejszą datę jako domyślną
function setDefaultDate() {
  const today = new Date().toISOString().split('T')[0]; // Pobranie dzisiejszej daty w formacie YYYY-MM-DD
  document.getElementById('unload_date').value = today; // Ustawienie dla daty rozładunku
  document.getElementById('pickup_date').value = today; // Ustawienie dla daty odbioru
}

// Wywołanie funkcji po załadowaniu strony
window.onload = setDefaultDate;
</script>

</body>
</html>
