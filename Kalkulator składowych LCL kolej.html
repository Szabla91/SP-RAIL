<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Kalkulator Składowania LCL Kolej</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background-color: #fff; color: #222; margin: 0; padding: 0; }
    .page-content { padding: 40px; max-width: 1000px; margin: 0 auto; }
    h1 { color: #be1e2d; border-bottom: 2px solid #be1e2d; padding-bottom: 10px; margin-bottom: 30px; font-size: 2.3rem; text-align: center; font-weight: 700; }
    .section { background-color: #fafbfc; margin-bottom: 30px; border: 1.5px solid #e5e5e5; padding: 28px 24px; border-radius: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); max-width: 600px; margin-left: auto; margin-right: auto; }
    label { display: block; margin-top: 16px; font-weight: 500; color: #222; }
    select, input[type="date"], input[type="number"] { padding: 7px 12px; border: 1.5px solid #ccc; border-radius: 7px; width: 100%; max-width: 340px; margin-top: 5px; font-size: 1rem; box-sizing: border-box; font-family: inherit; }
    button { margin-top: 25px; padding: 12px 28px; background-color: #be1e2d; color: white; border: none; border-radius: 7px; cursor: pointer; font-weight: 700; font-size: 1.04rem; transition: background-color 0.22s; letter-spacing: 0.03em; }
    button:hover { background-color: #a31520; }
    #result_storage { margin-top: 26px; border-top: 1px solid #ddd; padding-top: 18px; color: #222; font-size: 1.06rem; }
    .hidden { display: none; }
    @media (max-width: 700px) { .page-content { padding: 15px; } .section { padding: 16px 5px; } }
  </style>
</head>
<body>
<div class="page-content">
  <h1>Kalkulator Składowania LCL - Kolej</h1>
  <div class="section">
    <!-- Wybór agenta dekonsolidacyjnego -->
    <label for="agent">Agent dekonsolidacyjny:</label>
    <select id="agent">
      <option value="">Wybierz agenta</option>
      <option value="WŁASNA KONSOLA">WŁASNA KONSOLA</option>
      <option value="ELCOM">ELCOM</option>
      <option value="BUS">BUS</option>
      <option value="ENTREGA">ENTREGA</option>
      <option value="IGS">IGS</option>
      <option value="UCS">UCS</option>
    </select>

    <!-- Ilość W/M -->
    <label style="margin-top:20px;">
      Ilość W/M (waga/miara):
      <input type="number" id="wm" min="0" step="0.01" placeholder="np. 1.00" />
    </label>

    <label style="margin-top:20px;">Data rozładunku towaru na magazynie:
      <input type="date" id="unload_date" />
    </label>

    <label>Data odbioru towaru z magazynu:
      <input type="date" id="pickup_date" />
    </label>

    <button type="button" onclick="calculateRailStorage()">Oblicz koszty składowania</button>

    <div id="result_storage"></div>
  </div>
</div>

<script>
const railPricing = {
  "WŁASNA KONSOLA": { freeDays: 5, dailyRate: 1.8, minCost: 0, currency: "PLN" },
  "ELCOM": { freeDays: 5, dailyRate: 2, minCost: 15, currency: "USD" },
  "BUS": { freeDays: 5, dailyRate: 2, minCost: 15, currency: "USD" },
  "ENTREGA": { freeDays: 5, dailyRate: 1.5, minCost: 30, currency: "USD" },
  "IGS": { freeDays: 4, dailyRate: 3, minCost: 20, currency: "EUR" },
  "UCS": { freeDays: 5, minCost: 25, currency: "EUR" }, // UCS będzie miał osobny cennik zależny od dni
};

function calculateRailStorage() {
  const agent = document.getElementById('agent').value;
  const unloadDate = new Date(document.getElementById('unload_date').value);
  const pickupDate = new Date(document.getElementById('pickup_date').value);
  const wm = parseFloat(document.getElementById('wm').value);
  const resultBox = document.getElementById('result_storage');
  resultBox.innerHTML = '';

  let errorMessage = '';
  if (!agent) errorMessage += 'Proszę wybrać agenta dekonsolidacyjnego. ';
  if (isNaN(wm) || wm <= 0) errorMessage += 'Podaj ilość W/M większą od zera. ';
  if (unloadDate == "Invalid Date" || pickupDate == "Invalid Date") errorMessage += 'Wprowadź poprawne daty rozładunku i odbioru. ';
  if (unloadDate && pickupDate && pickupDate < unloadDate) errorMessage += 'Data odbioru nie może być wcześniejsza niż data rozładunku. ';

  if (errorMessage) {
    resultBox.innerHTML = `<p style="color: red;">${errorMessage}</p>`;
    return;
  }

  const daysInStorage = Math.round((pickupDate - unloadDate) / (24 * 60 * 60 * 1000)) + 1;
  const pricing = railPricing[agent];

  if (!pricing) {
    resultBox.innerHTML = `<p style="color: red;">Brak cennika dla wybranego agenta.</p>`;
    return;
  }

  let totalCost = 0;
  let exceededDays = Math.max(0, daysInStorage - pricing.freeDays);

  // Cennik dla UCS zależny od dni
  if (agent === "UCS") {
    // Obliczanie kosztu na podstawie dni
    if (exceededDays > 0) {
      if (exceededDays <= 7) {
        totalCost = exceededDays * 3 * wm; // Dni 1-7 -> 3 EUR
      } else if (exceededDays <= 14) {
        totalCost = (7 * 3 + (exceededDays - 7) * 5) * wm; // Dni 8-14 -> 5 EUR
      } else if (exceededDays <= 21) {
        totalCost = (7 * 3 + 7 * 5 + (exceededDays - 14) * 8) * wm; // Dni 15-21 -> 8 EUR
      } else {
        totalCost = (7 * 3 + 7 * 5 + 7 * 8 + (exceededDays - 21) * 16) * wm; // Ponad 22 dni -> 16 EUR
      }
    }
    totalCost = Math.max(totalCost, 25); // Min. 25 EUR
  } else {
    // Cennik dla pozostałych agentów
    totalCost = exceededDays * pricing.dailyRate * wm;
    if (totalCost < pricing.minCost && exceededDays > 0) totalCost = pricing.minCost;
  }

  // Generowanie zakresu dni wolnych
  const freeStartDate = new Date(unloadDate);
  const freeEndDate = new Date(unloadDate);
  freeEndDate.setDate(freeEndDate.getDate() + pricing.freeDays - 1); // Dodaj dni wolne do daty rozładunku
  const freeDaysRange = `${freeStartDate.toLocaleDateString('pl-PL')} - ${freeEndDate.toLocaleDateString('pl-PL')}`;

  // Generowanie zakresu dni przekroczonych
  const exceededStartDate = new Date(freeEndDate);
  exceededStartDate.setDate(exceededStartDate.getDate() + 1); // Pierwszy przekroczony dzień to dzień po ostatnim dniu wolnym
  const exceededEndDate = new Date(pickupDate);
  let exceededDaysRange = '';
  if (exceededDays > 0) {
    exceededDaysRange = `${exceededStartDate.toLocaleDateString('pl-PL')} - ${exceededEndDate.toLocaleDateString('pl-PL')}`;
  }

  // Dodanie cennika UCS do stawki za dzień
  let rateDetails = `${pricing.dailyRate} ${pricing.currency} / CBM`;
  if (agent === "UCS") {
    rateDetails = `Dni 1-7 -> 3 EUR / w/m <br>
Dni 8-14 -> 5 EUR / w/m <br>
Dni 15-21 -> 8 EUR / w/m <br>
Ponad 22 dni -> 16 EUR / w/m`;
  }

  if (agent === "UCS") {
    resultBox.innerHTML = `
      <p><strong>Okres składowania:</strong> ${unloadDate.toLocaleDateString('pl-PL')} – ${pickupDate.toLocaleDateString('pl-PL')}</p>
      <p><strong>Dni wolne:</strong> ${pricing.freeDays} (${freeDaysRange})</p>
      <p><strong>Przekroczone dni:</strong> ${exceededDays} ${exceededDays > 0 ? `(${exceededDaysRange})` : ''}</p>
      <p><strong>Cennik:</strong> <br>${rateDetails}</p>
      <p><strong>Minimalna stawka:</strong> ${pricing.minCost} ${pricing.currency}</p>
      <p><strong><b>Łączny koszt:</b> <span style="color:#be1e2d;">${totalCost.toFixed(2)} ${pricing.currency}</span></strong></p>
    `;
  } else {
    resultBox.innerHTML = `
      <p><strong>Okres składowania:</strong> ${unloadDate.toLocaleDateString('pl-PL')} – ${pickupDate.toLocaleDateString('pl-PL')}</p>
      <p><strong>Dni wolne:</strong> ${pricing.freeDays} (${freeDaysRange})</p>
      <p><strong>Przekroczone dni:</strong> ${exceededDays} ${exceededDays > 0 ? `(${exceededDaysRange})` : ''}</p>
      <p><strong>Stawka za dzień:</strong> ${pricing.dailyRate} ${pricing.currency} / CBM</p>
      <p><strong>Minimalna stawka:</strong> ${pricing.minCost} ${pricing.currency}</p>
      <p><strong><b>Łączny koszt:</b> <span style="color:#be1e2d;">${totalCost.toFixed(2)} ${pricing.currency}</span></strong></p>
    `;
  }
}

// Funkcja ustawiająca dzisiejszą datę jako domyślną
function setDefaultDate() {
  const today = new Date().toISOString().split('T')[0]; // Pobranie dzisiejszej daty w formacie YYYY-MM-DD
  document.getElementById('unload_date').value = today; // Ustawienie dla daty rozładunku
  document.getElementById('pickup_date').value = today; // Ustawienie dla daty odbioru
}

// Wywołanie funkcji po załadowaniu strony
window.onload = setDefaultDate;

</script>

</body>
</html>
